# Introduction #

Welcome to the wiki of the Java wikipedia parser. In this document you will learn how to convert wikipedia wikitext notation to HTML.

# Depedencies #

In order to use this parser make sure you have these two JAR files on your classpath:

  * wikipedia-parser.jar (part of the distribution)
  * commons-lang.jar (part of the distribution, generally available from many locations)

# Usage #

## Basic usage ##

The quickest way to use this parser is by using the convenience `be.devijver.wikipedia.Parser` class. This class has methods to convert wikipedia wikitext notation to HTML in one call:

```
String wikitext = "'''This is bold'''";
String html = be.devijver.wikipedia.Parser.toHtml(wikitext, null);
```

This will work as long as you don't use smart links in your wikitext.

## Resolving smart links ##

Smart links refer to key words instead of URLs. The smart link below links to the article on Thomas Jefferson:

```
[[Thomas Jefferson]]
```

The parser however cannot know which URL to link to. Ideally, we want the parser to generate this HTML tag for us:

```
<a href="http://en.wikipedia.org/wiki/Thomas_Jefferson">Thomas Jefferson</a>
```

To make this happen we need to pass our own implementation of the `be.devijver.wikipedia.SmartLinkResolver` class:

```
be.devijver.wikipedia.SmartLinkResolver smartLinkResolver =
   new be.devijver.wikipedia.SmartLinkResolver() {
      public String resolve(String smartLink) {
         if (smartLink.equals("Thomas Jefferson")) {
            return "http://en.wikipedia.org/wiki/Thomas_Jefferson";
         }
      }
   };

String wikitext = "[[Thomas Jefferson]]";
String html = be.devijver.wikipedia.Parser.toHtml(wikitext, smartLinkResolver);
```

The parser will call the `resolve()` method for each smart link it encounters.

A `be.devijver.wikipedia.SmartLinkResolver` implementation shall not return null. If the `resolve()` method returns null the parser will throw an exception.

## Writing to a writer ##

You can let the `be.devijver.wikipedia.Parser` class write to a `java.io.Writer` object instead of returning a string:

```
String wikiNotation = "#Item one of a numbered list";
java.io.StringWriter writer = new java.io.StringWriter();
be.devijver.wikipedia.Parser.toHtml(wikiNotation, null, writer);
writer.flush();
```

You can let the parser flush on a regular basis in case you want to stream the result. In this case the parser will flush after an important HTML element has been closed, and also at the end of the HTML generation:

```
String wikiNotation = "== Heading 1 ==";
java.io.FileWriter output = new java.io.FileWriter("output.html");
be.devijver.wikipedia.Parser.toHtml(wikiNotation, null, output, true);
```

## Custom output ##

The parser comes with an HTML generator. You can however control the output that is being generated by passing your own implementation of the `be.devijver.wikipedia.Visitor` interface.

Here are the methods defined on this interface:

```
package be.devijver.wikipedia;
import be.devijver.wikipedia.parser.ast.AttributeList;

public interface Visitor {
    void endBold();
    void endCaption();
    void endDocument();
    void endHeading1();
    void endHeading2();
    void endHeading3();
    void endHeading4();
    void endHeading5();
    void endHeading6();
    void endIndent();
    void endItalics();
    void endLiteral();
    void endNormalLinkWithCaption();
    void endOrderedList();
    void endOrderedListItem();
    void endParagraph();
    void endPre();
    void endSmartLinkWithCaption();
    void endTable();
    void endTableData();
    void endTableHeader();
    void endTableRecord();
    void endUnorderedList();
    void endUnorderedListItem();
    void handleNormalLinkWithoutCaption(String string);
    void handleNowiki(String nowiki);
    void handleSmartLinkWithoutCaption(String string);
    void handleString(String s);
    void startBold();
    void startCaption(AttributeList captionOptions);
    void startDocument();
    void startHeading1();
    void startHeading2();
    void startHeading3();
    void startHeading4();
    void startHeading5();
    void startHeading6();
    void startIndent();
    void startItalics();
    void startLiteral();
    void startNormalLinkWithCaption(String s);
    void startOrderedList();
    void startOrderedListItem();
    void startParagraph();
    void startPre();
    void startSmartLinkWithCaption(String s);
    void startTable(AttributeList tableOptions);
    void startTableData(AttributeList options);
    void startTableHeader(AttributeList list);
    void startTableRecord(AttributeList rowOptions);
    void startUnorderedList();
    void startUnorderedListItem();
}
```

The parser comes with one implementation class for the visitor interface: `be.devijver.wikipedia.html.HtmlVisitor`. This class is responsible for generating HTML output

If you wish to modify the HTML output you can extend the `be.devijver.wikipedia.html.HtmlVisitor` class and overwrite selected methods. If you wish to output the parsing results in a different way you can write your own implementation of the `be.devijver.wikipedia.Visitor` interface.

As an example, let's say you want to use the <strong> and <em> tags in the HTML output instead of <b> and <i>. You extend the <code>be.devijver.wikipedia.html.HtmlVisitor</code> class as follows:<br>
<br>
<pre><code>import java.io.Writer;<br>
import be.devijver.wikipedia.SmartLinkResolver;<br>
import be.devijver.wikipedia.html.HtmlVisitor;<br>
<br>
<br>
public class MyHtmlVisitor extends HtmlVisitor {<br>
   public MyHtmlVisitor(Writer out, SmartLinkResolver resolver) {<br>
      super(writer, resolver);<br>
   }<br>
<br>
   public void startBold() {<br>
      output.append("&lt;strong&gt;");<br>
   }<br>
<br>
   public void endBold() {<br>
      output.append("&lt;/strong&gt;");<br>
   }<br>
<br>
   public void startItalics() {<br>
      output.append("&lt;em&gt;");<br>
   }<br>
<br>
   public void endItalics() {<br>
      output.append("&lt;/em&gt;");<br>
   }<br>
}<br>
</code></pre>

Next you can you pass your visitor object to the <code>withVisitor()</code> method on <code>be.devijver.wikipedia.Parser</code>:<br>
<br>
<pre><code>String wikiNotation = "'''Bold''' and ''italics''.";<br>
<br>
java.io.StringWriter writer = new StringWriter();<br>
be.devijver.wikipedia.Visitor visitor = new MyHtmlVisitor(writer, null);<br>
be.devijver.wikipedia.Parser.withVisitor(wikiNotation, visitor);<br>
writer.flush();<br>
</code></pre>

The generated HTML will look like this:<br>
<br>
<pre><code>&lt;div&gt;<br>
&lt;p&gt;&lt;strong&gt;Bold&lt;/strong&gt; and &lt;em&gt;italics&lt;/em&gt;.&lt;/p&gt;<br>
&lt;/div&gt;<br>
</code></pre>